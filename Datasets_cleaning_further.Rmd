---
title: "Data cleaning_NELDA"
author: "Domenic HÃ¶g"
date: "2024-06-20"
output: html_document
---

```{r}
library(haven)
library(dplyr)
library(tidyverse)
library(stringr)
library(readxl)
```

# Loading NELDA data

```{r}
NELDA_broad <- read_xls("NELDA.xls")
```

## Stepts of data wrangling
- check if special characters used 
- check for country base


### Deleting special characters 
Deleted special characters are - / and '. Besides, I have decoded N/A in the df to NA so that they are recognised as missing values. 
```{r}
NELDA_broad <- NELDA_broad %>%
  mutate(across(where(is.character), ~ na_if(., "N/A")))

NELDA_broad <- NELDA_broad %>%
  mutate(across(where(is.character), ~ str_replace_all(., "-", " ")))

NELDA_broad <- NELDA_broad %>%
  mutate(across(where(is.character), ~ str_replace_all(., "/", " ")))

NELDA_broad <- NELDA_broad %>%
  mutate(across(where(is.character), ~ str_replace_all(., "'", "")))

```


### Checking for missing values and included countries 
```{r}
prop.table(table(NELDA_broad$nelda30, useNA = "ifany"))
prop.table(table(NELDA_broad$nelda30))
table(NELDA_broad$nelda45, useNA = "ifany")
prop.table(table(NELDA_broad$nelda45, useNA = "ifany"))
prop.table(table(NELDA_broad$nelda45))
table(NELDA_broad$nelda48, useNA = "ifany")
prop.table(table(NELDA_broad$nelda48, useNA = "ifany"))
prop.table(table(NELDA_broad$nelda48))
length(unique(NELDA_broad$stateid))
max(NELDA_broad$year)
```
# Vdem civil liberty index
```{r}
Vdem <- read.csv("V-Dem-CD-v14.csv")
```

## Steps of data wrangling 
- subset timewise (post 1945)
- check special characters
- check for country base 

### Subsetting
```{r}
Vdem_subset <- subset(Vdem, Vdem$year >= 1945)
length(unique(Vdem_subset$country_text_id))
table(Vdem_subset$country_name)
table(Vdem_subset$country_text_id)
```
One could group the data by year. 

### Checking for missing values
Checking for NAs in relevant variables per country
```{r}
Vdem_grouped <- Vdem_subset %>%
  group_by(country_text_id) %>%
  summarise(
    missing_regcorr = sum(is.na(v2xnp_regcorr)),
    actual_regcorr = sum(!is.na(v2xnp_regcorr)),
    missing_clphy = sum(is.na(v2x_clphy)),
    actual_clphy = sum(!is.na(v2x_clphy)),
    missing_csreprss = sum(is.na(v2csreprss)),
    actual_csreprss = sum(!is.na(v2csreprss)),
    missing_rlgrep = sum(is.na(v2csrlgrep)),
    actual_rlgrep = sum(!is.na(v2csrlgrep))
  ) %>%
  mutate(
    percent_regcorr = (actual_regcorr / (actual_regcorr + missing_regcorr)) * 100,
    percent_clphy = (actual_clphy / (actual_clphy + missing_clphy)) * 100,
    percent_csreprss = (actual_csreprss / (actual_csreprss + missing_csreprss)) * 100,
    percent_rlgrep = (actual_rlgrep / (actual_rlgrep + missing_rlgrep)) * 100
  )

print(Vdem_grouped)

```


# GTB Dataset
```{r}
GTB <- read_excel("GTB_1970-2022.xlsx")
```

## Steps of data wrangling:
- country check up
- deleting special values 
- controlling for NAs

### Checking for countries included
```{r}
table(GTB$country)
length(unique(GTB$country))
```

### Deleting special characters
```{r}
GTB <- GTB %>%
  mutate(across(where(is.character), ~ str_replace_all(., "-", " "))) %>%
  mutate(across(where(is.character), ~ str_replace_all(., "/", " "))) %>%
  mutate(across(where(is.character), ~ str_replace_all(., "'", ""))) %>%
  mutate(across(where(is.character), ~ str_replace_all(., "&", "and"))) %>%
  mutate(across(where(is.character), ~ str_replace_all(., "\\(", ""))) %>%
  mutate(across(where(is.character), ~ str_replace_all(., "\\)", "")))
```
 The seperation of dates is not optimal but these date_approx variable propably not necessary to use anyways. 
 
### Check for NAs 
Checking NAs in relevant variables 

```{r}
percentage_na <- GTB %>%
  summarise(across(
    c(country, provstate, latitude, longitude, attacktype1, weaptype1, targtype1,
      gname, nperpcap, claimed, nkill, nkillus, nwound, propvalue, ndays),
    ~ mean(is.na(.)) * 100,
    .names = "percent_na_{col}"
  ))

percentage_actual <- GTB %>%
  summarise(across(
    c(country, provstate, latitude, longitude, attacktype1, weaptype1, targtype1,
      gname, nperpcap, claimed, nkill, nkillus, nwound, propvalue, ndays),
    ~ mean(!is.na(.)) * 100,
    .names = "percent_actual_{col}"))

print(percentage_na)
print(percentage_actual)
```

# ACLED
```{r}
ACLED <- read.csv("ACLED_1997-2024.csv")
```

## Steps for data wrangling


```{r}
table(ACLED$sub_event_type)
table(ACLED$event_type)
table(ACLED$civilian_targeting, useNA = "ifany")
```

```{r}
ACLED[ACLED == ""] <- NA
percentage_na_acled <- ACLED %>%
  summarise(across(
    c(year, location, latitude, longitude, sub_event_type, actor1, actor2, interaction,
      fatalities, civilian_targeting, assoc_actor_1),
    ~ mean(is.na(.)) * 100,
    .names = "percent_na_acled_{col}"
  ))

percentage_actual_acled <- ACLED %>%
  summarise(across(
    c(year, location, latitude, longitude, sub_event_type, actor1, actor2, interaction,
      fatalities, civilian_targeting, assoc_actor_1),
    ~ mean(!is.na(.)) * 100,
    .names = "percent_actual_acled_{col}"))

print(percentage_na_acled)
print(percentage_actual_acled)
```

```{r}
ACLED_sub <- subset(ACLED, ACLED$sub_event_type == "Excessive force against protesters")
```

```{r}
ACLED_sub[ACLED_sub == ""] <- NA
percentage_na_acled_sub <- ACLED_sub %>%
  summarise(across(
    c(year, location, latitude, longitude, sub_event_type, actor1, actor2, interaction,
      fatalities, civilian_targeting, assoc_actor_1),
    ~ mean(is.na(.)) * 100,
    .names = "percent_na_acled_sub_{col}"
  ))

percentage_actual_acled_sub <- ACLED_sub %>%
  summarise(across(
    c(year, location, latitude, longitude, sub_event_type, actor1, actor2, interaction,
      fatalities, civilian_targeting, assoc_actor_1),
    ~ mean(!is.na(.)) * 100,
    .names = "percent_actual_acled_sub_{col}"))

print(percentage_na_acled_sub)
print(percentage_actual_acled_sub)
```

```{r}
table(ACLED$country)
length(unique(ACLED_sub$country))
length(unique(ACLED$country))
```
```{r}
ACLED_sub <- ACLED_sub %>%
  mutate(across(where(is.character), ~ str_replace_all(., "-", " "))) %>%
  mutate(across(where(is.character), ~ str_replace_all(., "/", " "))) %>%
  mutate(across(where(is.character), ~ str_replace_all(., "'", ""))) %>%
  mutate(across(where(is.character), ~ str_replace_all(., "&", "and"))) %>%
  mutate(across(where(is.character), ~ str_replace_all(., "\\(", ""))) %>%
  mutate(across(where(is.character), ~ str_replace_all(., "\\)", ""))) %>%
  mutate(across(where(is.character), ~ str_replace_all(., ";", "and"))) %>%
  mutate(across(where(is.character), ~ str_replace_all(., "Political violenceand Demonstrations", "Political violence and Demonstrations")))

ACLED <- ACLED %>%
  mutate(across(where(is.character), ~ str_replace_all(., "-", " "))) %>%
  mutate(across(where(is.character), ~ str_replace_all(., "/", " "))) %>%
  mutate(across(where(is.character), ~ str_replace_all(., "'", ""))) %>%
  mutate(across(where(is.character), ~ str_replace_all(., "&", "and"))) %>%
  mutate(across(where(is.character), ~ str_replace_all(., "\\(", ""))) %>%
  mutate(across(where(is.character), ~ str_replace_all(., "\\)", ""))) %>%
  mutate(across(where(is.character), ~ str_replace_all(., ";", "and"))) %>%
  mutate(across(where(is.character), ~ str_replace_all(., "Political violenceand Demonstrations", "Political violence and Demonstrations")))
```


# Althaus et al. Coup Data
```{r}
Coup_data <- read.csv("Coup data 2.1.3.csv")
```

### Checking for country base
```{r}
table(Coup_data$country)
length(unique(Coup_data$country))
```
```{r}
percentage_na_coup <- Coup_data %>%
  summarise(across(
    c(cowcode, country, year, month, day, event_type, military, dissident, 
      rebel, foreign, noharm, injured, killed),
    ~ mean(is.na(.)) * 100,
    .names = "percent_na_coup_{col}"
  ))

percentage_actual_coup <- Coup_data %>%
  summarise(across(
    c(cowcode, country, year, month, day, event_type, military, dissident, 
      rebel, foreign, noharm, injured, killed),
    ~ mean(!is.na(.)) * 100,
    .names = "percent_actual_coup_{col}"))

print(percentage_na_coup)
print(percentage_actual_coup)
```

# IDS 

```{r}
IDS <- read_excel("IDS_data complete.xlsx")

```


### Checking for country base
```{r}
length(unique(IDS$ISO3))
table(IDS$`Country/Territory of Seizure`)
```
### Checking for NAs in relevant variables
```{r}
percentage_na_ids <- IDS %>%
  summarise(across(
    c(`Seizure Date`, ISO3, City, `Drug/Substance`, `Quantity Seized`, `Measurement Unit`),
    ~ mean(is.na(.)) * 100,
    .names = "percent_na_ids_{col}"
  ))

percentage_actual_ids <- IDS %>%
  summarise(across(
    c(`Seizure Date`, ISO3, City, `Drug/Substance`, `Quantity Seized`, `Measurement Unit`),
    ~ mean(!is.na(.)) * 100,
    .names = "percent_actual_ids_{col}"))

print(percentage_na_ids)
print(percentage_actual_ids)
```
### Replacing special characters
```{r}
IDS <- IDS %>%
  mutate(across(where(is.character), ~ str_replace_all(., "/", " "))) %>%
  mutate(across(where(is.character), ~ str_replace_all(., "'", ""))) %>%
  mutate(across(where(is.character), ~ str_replace_all(., "\\(", ""))) %>%
  mutate(across(where(is.character), ~ str_replace_all(., "\\)", ""))) %>%
  mutate(across(where(is.character), ~ str_replace_all(., ";", "and")))
  
```

# Eurepoc
 
```{r}
eurepoc <- read_excel("eurepoc_data_2024-06-17T12_43.xlsx")
```

### Checking for NAs in relevant variables 
```{r}
eurepoc[eurepoc == "Not available"] <- NA
eurepoc[eurepoc == "unknown"] <- NA
percentage_na_eurepoc <- eurepoc %>%
  summarise(across(
    c(name, description, start_date, end_date, inclusion_criteria, incident_type, 
      receiver_country, receiver_name, receiver_category, initiator_name, initiator_country, 
      political_response_date, political_response_type),
    ~ mean(is.na(.)) * 100,
    .names = "percent_na_eurepoc_{col}"
  ))

percentage_actual_eurepoc <- eurepoc %>%
  summarise(across(
    c(name, description, start_date, end_date, inclusion_criteria, incident_type, 
      receiver_country, receiver_name, receiver_category, initiator_name, initiator_country, 
      political_response_date, political_response_type),
    ~ mean(!is.na(.)) * 100,
    .names = "percent_actual_eurepoc_{col}"))

print(percentage_na_eurepoc)
print(percentage_actual_eurepoc)
```

```{r}
length(unique(eurepoc$receiver_country))
```

